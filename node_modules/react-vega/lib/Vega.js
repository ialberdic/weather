"use strict";exports.__esModule=!0,exports.default=void 0;var vega=_interopRequireWildcard(require("vega")),_propTypes=_interopRequireDefault(require("prop-types")),_react=_interopRequireDefault(require("react")),_vegaEmbed=_interopRequireDefault(require("vega-embed")),_util=require("./util");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}return b.default=a,b}function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}function _inheritsLoose(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.__proto__=b}var propTypes={background:_propTypes.default.string,className:_propTypes.default.string,data:_propTypes.default.object,enableHover:_propTypes.default.bool,height:_propTypes.default.number,logLevel:_propTypes.default.number,onNewView:_propTypes.default.func,onParseError:_propTypes.default.func,padding:_propTypes.default.object,renderer:_propTypes.default.string,spec:_propTypes.default.object.isRequired,style:_propTypes.default.object,tooltip:_propTypes.default.func,width:_propTypes.default.number},defaultProps={background:void 0,className:"",data:{},enableHover:!0,height:void 0,logLevel:void 0,onNewView:function onNewView(){},onParseError:function onParseError(){},padding:void 0,renderer:"svg",style:void 0,tooltip:function tooltip(){},width:void 0},Vega=/*#__PURE__*/function(a){function b(){return a.apply(this,arguments)||this}_inheritsLoose(b,a),b.isSamePadding=function isSamePadding(c,a){return(0,_util.isDefined)(c)&&(0,_util.isDefined)(a)?c.top===a.top&&c.left===a.left&&c.right===a.right&&c.bottom===a.bottom:c===a},b.isSameData=function isSameData(c,a){return c===a&&!(0,_util.isFunction)(c)},b.isSameSpec=function isSameSpec(c,a){return c===a||JSON.stringify(c)===JSON.stringify(a)},b.listenerName=function listenerName(a){return"onSignal"+(0,_util.capitalize)(a)};var c=b.prototype;return c.componentDidMount=function componentDidMount(){var a=this.props.spec;this.createView(a)},c.componentDidUpdate=function componentDidUpdate(a){var c=this,d=this.props.spec;if(d!==a.spec)this.clearView(),this.createView(d);else if(this.view){var e=this.props,f=!1;["width","height","renderer","logLevel","background"].filter(function(b){return e[b]!==a[b]}).forEach(function(a){c.view[a](e[a]),f=!0}),b.isSamePadding(e.padding,a.padding)||(this.view.padding(e.padding||d.padding),f=!0),d.data&&e.data&&d.data.forEach(function(g){var d=a.data[g.name],h=e.data[g.name];b.isSameData(d,h)||(c.updateData(g.name,h),f=!0)}),!a.enableHover&&e.enableHover&&(this.view.hover(),f=!0),f&&this.view.run()}},c.componentWillUnmount=function componentWillUnmount(){this.clearView()},c.createView=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(c){var e,f,g,h=this;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!c){a.next=20;break}return e=this.props,a.prev=2,a.next=5,(0,_vegaEmbed.default)(this.element,c,this.propsToEmbedOptions(e));case 5:f=a.sent,g=f.view,c.signals&&c.signals.forEach(function(a){g.addSignalListener(a.name,function(){var c=e[b.listenerName(a.name)];if(c){for(var d=arguments.length,f=Array(d),g=0;g<d;g++)f[g]=arguments[g];c.apply(h,f)}})}),this.view=g,c.data&&e.data&&c.data.filter(function(a){return e.data[a.name]}).forEach(function(a){h.updateData(a.name,e.data[a.name])}),g.run(),e.onNewView(g),a.next=18;break;case 14:a.prev=14,a.t0=a["catch"](2),this.clearView(),e.onParseError(a.t0);case 18:a.next=21;break;case 20:this.clearView();case 21:return a.abrupt("return",this);case 22:case"end":return a.stop();}},a,this,[[2,14]])}));return function createView(){return a.apply(this,arguments)}}(),c.updateData=function updateData(a,b){b&&((0,_util.isFunction)(b)?b(this.view.data(a)):this.view.change(a,vega.changeset().remove(function(){return!0}).insert(b)))},c.propsToEmbedOptions=function propsToEmbedOptions(a){return _extends({},a.enableHover?{hover:a.enableHover}:{},{},a.height?{height:a.height}:{},{},a.logLevel?{logLevel:a.logLevel}:{},{},a.padding?{padding:a.padding}:{},{},a.renderer?{renderer:a.renderer}:{},{},a.tooltip?{tooltip:a.tooltip}:{},{},a.width?{width:a.width}:{})},c.clearView=function clearView(){return this.view&&(this.view.finalize(),this.view=null),this},c.render=function render(){var a=this,b=this.props,c=b.className,d=b.style;return(// Create the container Vega draws inside
_react.default.createElement("div",{ref:function ref(b){a.element=b},className:c,style:d}))},b}(_react.default.Component);Vega.propTypes=propTypes,Vega.defaultProps=defaultProps;var _default=Vega;exports.default=_default;